<!doctype html><meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Fichaje</title>
<body style="font-family:system-ui,Arial;padding:24px;text-align:center">
  <h3>Fichaje Puertas Lloris</h3>
  <p>Registrando fichaje…</p>

  <script>
    // Lee parámetros del email
    const p = new URLSearchParams(location.search);
    const base = "https://script.google.com/macros/s/AKfycbzQgMYWw08WXbJr5_SOhGKiHyqlU_Sh0ZU67dg2yS9DjDBMRMUbLemPBU9apPdKQa-c/exec";
    // Llamada "beacon" que ejecuta el doGet sin navegar (evita Google Drive Viewer)
    const url = base + "?" + p.toString() + "&plain=1&t=" + Date.now();

    // 1) Disparo inmediato como imagen invisible (GET anónimo)
    const img = new Image();
    img.width = img.height = 1; img.style = "position:absolute;left:-9999px;top:-9999px";
    img.src = url;
    document.body.appendChild(img);

    // 2) También por fetch para asegurar (algunos iOS no cuentan IMG si se cancela)
    try { fetch(url, {mode:"no-cors"}).catch(()=>{}); } catch(_){}

    // 3) Mensaje de OK en pantalla y cierre opcional
    const nombre = p.get('nombre') || '';
    const tipo   = (p.get('tipo')||'').toUpperCase();
    const stamp  = new Date().toLocaleString('es-ES');
    const ok = document.createElement('p');
    ok.innerHTML = `<b>OK ${nombre} — ${tipo}</b><br>${stamp}<br><small>Puedes cerrar esta pestaña.</small>`;
    document.body.appendChild(ok);
  </script>
</body>
